<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GS Store - Sistema de Comprovantes</title>

    <!-- FrameWorks All used -->
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- jQuery -->
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <!-- IMask.js -->
    <script src="https://unpkg.com/imask"></script>
    <!-- jsPDF -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>


    
    <!-- Link connect to CSS -->
    <link href="style.css" rel="stylesheet">

</head>
<body>
    <!-- Hamburger Menu -->
    <nav class="hamburger fixed top-4 left-4 z-50">
        <button id="hamburgerBtn" class="text-white focus:outline-none">
            <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
            </svg>
        </button>
    </nav>
    <div id="sidebar" class="sidebar fixed top-0 left-0 h-full w-64 bg-[#1a1a3d] shadow-lg transition-transform">
        <div class="flex items-center justify-between p-4 border-b border-[#ffffff33]">
            <h2 class="text-xl font-bold">GS Store</h2>
            <button id="closeSidebar" class="text-white">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                </svg>
            </button>
        </div>
        <ul class="mt-4">
            <li>
                <button class="w-full text-left px-4 py-2 text-lg hover:bg-[#2a2a5a]" data-bs-toggle="modal" data-bs-target="#vendaModal">Venda</button>
            </li>
            <li>
                <button class="w-full text-left px-4 py-2 text-lg hover:bg-[#2a2a5a]" data-bs-toggle="modal" data-bs-target="#osModal">Abrir OS</button>
            </li>
        </ul>
    </div>

    <!-- Header -->
    <header class="text-center py-4">
        <img src="./logo.png" alt="Logo" class="img-logo rounded-full mx-auto">
        <h1 class="text-3xl font-bold mt-2">GS Store</h1>
        <p class="text-lg">Sua paixão por tecnologia, nossa missão em conectar!</p>
    </header>

    <!-- Main Content -->
    <div class="container mx-auto px-4 py-8">
        <div class="quote-container text-center text-lg italic">
            <p id="dailyQuote">Carregando frase motivacional...</p>
        </div>
    </div>

    <!-- Venda Modal -->
    <div class="modal fade" id="vendaModal" tabindex="-1" aria-labelledby="vendaModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="vendaModalLabel">Realizar Venda</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="vendaForm">
                        <!-- Client Data -->
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <label for="vendaNome" class="form-label">Nome Completo</label>
                                <input type="text" class="form-control" id="vendaNome" required>
                            </div>
                            <div class="col-md-6">
                                <label for="vendaCpf" class="form-label">CPF</label>
                                <input type="text" class="form-control" id="vendaCpf" required>
                            </div>
                        </div>
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <label for="vendaCelular" class="form-label">Tel/Celular</label>
                                <input type="text" class="form-control" id="vendaCelular" required>
                            </div>
                            <div class="col-md-6">
                                <label for="vendaEmail" class="form-label">Email</label>
                                <input type="email" class="form-control" id="vendaEmail">
                            </div>
                        </div>
                        <div class="row mb-3">
                            <div class="col-md-3">
                                <label for="vendaCep" class="form-label">CEP</label>
                                <input type="text"clinic class="form-control" id="vendaCep">
                            </div>
                            <div class="col-md-6">
                                <label for="vendaEndereco" class="form-label">Endereço</label>
                                <input type="text" class="form-control" id="vendaEndereco">
                            </div>
                            <div class="col-md-3">
                                <label for="vendaNumero" class="form-label">Número</label>
                                <input type="text" class="form-control" id="vendaNumero">
                            </div>
                        </div>
                        <div class="row mb-3">
                            <div class="col-md-4">
                                <label for="vendaBairro" class="form-label">Bairro</label>
                                <input type="text" class="form-control" id="vendaBairro">
                            </div>
                            <div class="col-md-4">
                                <label for="vendaCidade" class="form-label">Cidade</label>
                                <input type="text" class="form-control" id="vendaCidade">
                            </div>
                            <div class="col-md-4">
                                <label for="vendaEstado" class="form-label">Estado</label>
                                <input type="text" class="form-control" id="vendaEstado">
                            </div>
                        </div>

                        <!-- Products -->
                        <div id="vendaProdutosContainer" class="mb-3">
                            <div class="product-row row">
                                <div class="col-md-5">
                                    <label class="form-label">Produto</label>
                                    <input type="text" class="form-control" name="produto[]" required>
                                </div>
                                <div class="col-md-3">
                                    <label class="form-label">Qtde</label>
                                    <input type="number" class="form-control" name="quantidade[]" min="1" required>
                                </div>
                                <div class="col-md-3">
                                    <label class="form-label">Valor</label>
                                    <input type="text" class="form-control" name="valor[]" required>
                                </div>
                                <div class="col-md-1 d-flex align-items-end">
                                    <button type="button" class="btn btn-danger btn-excluir-produto">X</button>
                                </div>
                            </div>
                        </div>
                        <button type="button" class="btn btn-secondary mb-3" id="vendaAdicionarProduto">Adicionar Produto</button>

                        <!-- Payment -->
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <label class="form-label">Forma de Pagamento</label>
                                <select class="form-control" id="vendaFormaPagamento" required>
                                    <option value="Dinheiro">Dinheiro</option>
                                    <option value="Pix">Pix</option>
                                    <option value="Crédito">Crédito</option>
                                    <option value="Débito">Débito</option>
                                </select>
                            </div>
                            <div class="col-md-6">
                                <label for="vendaValorPago" class="form-label">Valor Pago</label>
                                <input type="text" class="form-control" id="vendaValorPago" readonly>
                            </div>
                        </div>

                        <!-- Observations -->
                        <div class="mb-3">
                            <label class="form-label">Observações</label>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="vendaLacrado">
                                <label class="form-check-label" for="vendaLacrado">Lacrado</label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="vendaSemiNovo">
                                <label class="form-check-label" for="vendaSemiNovo">Semi-novo</label>
                            </div>
                            <textarea class="form-control" id="vendaObservacoes" rows="4"></textarea>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Fechar</button>
                    <button type="button" class="btn btn-primary" id="vendaGerarPdf">Gerar PDF</button>
                </div>
            </div>
        </div>
    </div>

    <!-- OS Modal -->
    <div class="modal fade" id="osModal" tabindex="-1" aria-labelledby="osModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="osModalLabel">Abrir OS</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="osForm">
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <label for="osNome" class="form-label">Nome Completo</label>
                                <input type="text" class="form-control" id="osNome" required>
                            </div>
                            <div class="col-md-6">
                                <label for="osCpf" class="form-label">CPF</label>
                                <input type="text" class="form-control" id="osCpf" required>
                            </div>
                        </div>
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <label for="osCelular" class="form-label">Tel/Celular</label>
                                <input type="text" class="form-control" id="osCelular" required>
                            </div>
                            <div class="col-md-6">
                                <label for="osEmail" class="form-label">Email</label>
                                <input type="email" class="form-control" id="osEmail">
                            </div>
                        </div>
                        <div class="row mb-3">
                            <div class="col-md-3">
                                <label for="osCep" class="form-label">CEP</label>
                                <input type="text" class="form-control" id="osCep">
                            </div>
                            <div class="col-md-6">
                                <label for="osEndereco" class="form-label">Endereço</label>
                                <input type="text" class="form-control" id="osEndereco">
                            </div>
                            <div class="col-md-3">
                                <label for="osNumero" class="form-label">Número</label>
                                <input type="text" class="form-control" id="osNumero">
                            </div>
                        </div>
                        <div class="row mb-3">
                            <div class="col-md-4">
                                <label for="osBairro" class="form-label">Bairro</label>
                                <input type="text" class="form-control" id="osBairro">
                            </div>
                            <div class="col-md-4">
                                <label for="osCidade" class="form-label">Cidade</label>
                                <input type="text" class="form-control" id="osCidade">
                            </div>
                            <div class="col-md-4">
                                <label for="osEstado" class="form-label">Estado</label>
                                <input type="text" class="form-control" id="osEstado">
                            </div>
                        </div>

                        <!-- Repairs -->
                        <div id="osReparosContainer" class="mb-3">
                            <div class="product-row row">
                                <div class="col-md-4">
                                    <label class="form-label">Modelo</label>
                                    <input type="text" class="form-control" name="modelo[]" required>
                                </div>
                                <div class="col-md-4">
                                    <label class="form-label">Reparos</label>
                                    <div class="reparos-container">
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" name="reparos[]" value="Tela c/ Touch">
                                            <label class="form-check-label">Tela c/ Touch</label>
                                        </div>
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" name="reparos[]" value="Tela s/ Touch">
                                            <label class="form-check-label">Tela s/ Touch</label>
                                        </div>
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" name="reparos[]" value="Tampa Traseira">
                                            <label class="form-check-label">Tampa Traseira</label>
                                        </div>
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" name="reparos[]" value="Botões">
                                            <label class="form-check-label">Botões</label>
                                        </div>
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" name="reparos[]" value="Bateria">
                                            <label class="form-check-label">Bateria</label>
                                        </div>
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" name="reparos[]" value="Alto Falante">
                                            <label class="form-check-label">Alto Falante</label>
                                        </div>
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" name="reparos[]" value="Conector">
                                            <label class="form-check-label">Conector</label>
                                        </div>
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" name="reparos[]" value="Placa">
                                            <label class="form-check-label">Placa</label>
                                        </div>
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" name="reparos[]" value="Aparelho Não Liga">
                                            <label class="form-check-label">Aparelho Não Liga</label>
                                        </div>
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" name="reparos[]" value="Outros">
                                            <label class="form-check-label">Outros</label>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <label class="form-label">Valor</label>
                                    <input type="text" class="form-control" name="valor[]" required>
                                </div>
                                <div class="col-md-1 d-flex align-items-end">
                                    <button type="button" class="btn btn-danger btn-excluir-produto">X</button>
                                </div>
                            </div>
                        </div>
                        <button type="button" class="btn btn-secondary mb-3" id="osAdicionarReparo">Adicionar Reparo</button>

                        <!-- Payment -->
                        <div class="row mb-3">
                            <div class="col-md-4">
                                <label class="form-label">Forma de Pagamento</label>
                                <select class="form-control" id="osFormaPagamento" required>
                                    <option value="Dinheiro">Dinheiro</option>
                                    <option value="Pix">Pix</option>
                                    <option value="Crédito">Crédito</option>
                                    <option value="Débito">Débito</option>
                                </select>
                            </div>
                            <div class="col-md-4">
                                <label for="osOrcamento" class="form-label">Valor do Orçamento</label>
                                <input type="text" class="form-control" id="osOrcamento" readonly>
                            </div>
                            <div class="col-md-4">
                                <label for="osValorPago" class="form-label">Valor Pago</label>
                                <input type="text" class="form-control" id="osValorPago" required>
                            </div>
                        </div>

                        <!-- Observations -->
                        <div class="mb-3">
                            <label for="osObservacoes" class="form-label">Observações</label>
                            <textarea class="form-control" id="osObservacoes" rows="4"></textarea>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Fechar</button>
                    <button type="button" class="btn btn-primary" id="osGerarPdf">Gerar PDF</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Toast Notification -->
    <div class="position-fixed bottom-0 end-0 p-3" style="z-index: 1051">
        <div id="successToast" class="toast hide" role="alert" aria-live="assertive" aria-atomic="true">
            <div class="toast-header bg-success text-white">
                <strong class="me-auto">Sucesso</strong>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="toast" aria-label="Close"></button>
            </div>
            <div class="toast-body">
                PDF gerado com sucesso!
            </div>
        </div>
    </div>

    <!-- Footer -->
    <div class="footer">
        GS Store © 2025
    </div>

    <!-- JavaScript -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Currency Mask Configuration
        const currencyMask = {
            mask: 'R$ num',
            blocks: {
                num: {
                    mask: Number,
                    thousandsSeparator: '.',
                    radix: ',',
                    scale: 2,
                    signed: false,
                    normalizeZeros: true,
                    padFractionalZeros: true
                }
            }
        };

        // Hamburger Menu Toggle
        const hamburgerBtn = document.getElementById('hamburgerBtn');
        const sidebar = document.getElementById('sidebar');
        const closeSidebar = document.getElementById('closeSidebar');

        hamburgerBtn.addEventListener('click', () => {
            sidebar.classList.toggle('open');
        });

        closeSidebar.addEventListener('click', () => {
            sidebar.classList.remove('open');
        });

        sidebar.querySelectorAll('button').forEach(btn => {
            btn.addEventListener('click', () => {
                sidebar.classList.remove('open');
            });
        });

        // Input Masks
        document.querySelectorAll('#vendaCpf, #osCpf').forEach(input => {
            IMask(input, { mask: '000.000.000-00' });
        });
        document.querySelectorAll('#vendaCelular, #osCelular').forEach(input => {
            IMask(input, { mask: '(00) 00000-0000' });
        });
        document.querySelectorAll('#vendaCep, #osCep').forEach(input => {
            IMask(input, { mask: '00000-000' });
        });

        // CEP Lookup Function
        async function fetchAddress(cep, prefix) {
            cep = cep.replace(/\D/g, '');
            if (cep.length !== 8) {
                alert('Por favor, insira um CEP válido com 8 dígitos.');
                return;
            }
            try {
                const response = await fetch(`https://viacep.com.br/ws/${cep}/json/`);
                const data = await response.json();
                if (data.erro) {
                    alert('CEP não encontrado. Verifique o número digitado.');
                    return;
                }
                document.getElementById(`${prefix}Endereco`).value = data.logradouro || '';
                document.getElementById(`${prefix}Bairro`).value = data.bairro || '';
                document.getElementById(`${prefix}Cidade`).value = data.localidade || '';
                document.getElementById(`${prefix}Estado`).value = data.uf || '';
            } catch (error) {
                console.error('Erro ao consultar CEP:', error);
                alert('Erro ao buscar o CEP. Tente novamente mais tarde.');
            }
        }

        document.querySelectorAll('#vendaCep, #osCep').forEach(input => {
            input.addEventListener('blur', () => {
                const prefix = input.id.replace('Cep', '').toLowerCase();
                fetchAddress(input.value, prefix);
            });
        });

        // Auto-Calculate Totals
        function updateVendaTotal() {
            const container = document.getElementById('vendaProdutosContainer');
            let total = 0;
            container.querySelectorAll('.product-row').forEach(row => {
                const quantidade = parseInt(row.querySelector('input[name="quantidade[]"]').value) || 0;
                const valorInput = row.querySelector('input[name="valor[]"]');
                const valor = parseFloat(IMask.createPipe(currencyMask)(valorInput.value).replace('R$ ', '').replace('.', '').replace(',', '.')) || 0;
                total += quantidade * valor;
            });
            const totalFormatted = IMask.createPipe(currencyMask)(total.toFixed(2).replace('.', ','));
            document.getElementById('vendaValorPago').value = totalFormatted;
        }

        function updateOSTotal() {
            const container = document.getElementById('osReparosContainer');
            let total = 0;
            container.querySelectorAll('.product-row').forEach(row => {
                const valorInput = row.querySelector('input[name="valor[]"]');
                const valor = parseFloat(IMask.createPipe(currencyMask)(valorInput.value).replace('R$ ', '').replace('.', '').replace(',', '.')) || 0;
                total += valor;
            });
            const totalFormatted = IMask.createPipe(currencyMask)(total.toFixed(2).replace('.', ','));
            document.getElementById('osOrcamento').value = totalFormatted;
        }

        // Add Product/Reparo Row
        function addRow(containerId, isVenda = true) {
            const container = document.getElementById(containerId);
            const row = document.createElement('div');
            row.className = 'product-row row';
            row.innerHTML = isVenda ?
                `<div class="col-md-5">
                    <label class="form-label">Produto</label>
                    <input type="text" class="form-control" name="produto[]" required>
                </div>
                <div class="col-md-3">
                    <label class="form-label">Qtde</label>
                    <input type="number" class="form-control" name="quantidade[]" min="1" required>
                </div>
                <div class="col-md-3">
                    <label class="form-label">Valor</label>
                    <input type="text" class="form-control" name="valor[]" required>
                </div>
                <div class="col-md-1 d-flex align-items-end">
                    <button type="button" class="btn btn-danger btn-excluir-produto">X</button>
                </div>` :
                `<div class="col-md-4">
                    <label class="form-label">Modelo</label>
                    <input type="text" class="form-control" name="modelo[]" required>
                </div>
                <div class="col-md-4">
                    <label class="form-label">Reparos</label>
                    <div class="reparos-container">
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" name="reparos[]" value="Tela c/ Touch">
                            <label class="form-check-label">Tela c/ Touch</label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" name="reparos[]" value="Tela s/ Touch">
                            <label class="form-check-label">Tela s/ Touch</label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" name="reparos[]" value="Tampa Traseira">
                            <label class="form-check-label">Tampa Traseira</label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" name="reparos[]" value="Botões">
                            <label class="form-check-label">Botões</label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" name="reparos[]" value="Bateria">
                            <label class="form-check-label">Bateria</label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" name="reparos[]" value="Alto Falante">
                            <label class="form-check-label">Alto Falante</label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" name="reparos[]" value="Conector">
                            <label class="form-check-label">Conector</label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" name="reparos[]" value="Placa">
                            <label class="form-check-label">Placa</label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" name="reparos[]" value="Aparelho Não Liga">
                            <label class="form-check-label">Aparelho Não Liga</label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" name="reparos[]" value="Outros">
                            <label class="form-check-label">Outros</label>
                        </div>
                    </div>
                </div>
                <div class="col-md-3">
                    <label class="form-label">Valor</label>
                    <input type="text" class="form-control" name="valor[]" required>
                </div>
                <div class="col-md-1 d-flex align-items-end">
                    <button type="button" class="btn btn-danger btn-excluir-produto">X</button>
                </div>`;
            container.appendChild(row);

            // Apply currency mask to new valor input
            if (isVenda) {
                const valorInput = row.querySelector('input[name="valor[]"]');
                IMask(valorInput, currencyMask);
                valorInput.addEventListener('input', updateVendaTotal);
                row.querySelector('input[name="quantidade[]"]').addEventListener('input', updateVendaTotal);
            } else {
                const valorInput = row.querySelector('input[name="valor[]"]');
                IMask(valorInput, currencyMask);
                valorInput.addEventListener('input', updateOSTotal);
            }
        }

        // Initialize Currency Masks and Event Listeners
        document.getElementById('vendaProdutosContainer').querySelectorAll('input[name="valor[]"]').forEach(input => {
            IMask(input, currencyMask);
            input.addEventListener('input', updateVendaTotal);
        });
        document.getElementById('vendaProdutosContainer').querySelectorAll('input[name="quantidade[]"]').forEach(input => {
            input.addEventListener('input', updateVendaTotal);
        });
        IMask(document.getElementById('vendaValorPago'), currencyMask);
        document.getElementById('osReparosContainer').querySelectorAll('input[name="valor[]"]').forEach(input => {
            IMask(input, currencyMask);
            input.addEventListener('input', updateOSTotal);
        });
        IMask(document.getElementById('osOrcamento'), currencyMask);
        IMask(document.getElementById('osValorPago'), currencyMask);

        document.getElementById('vendaAdicionarProduto').addEventListener('click', () => {
            addRow('vendaProdutosContainer');
            updateVendaTotal();
        });
        document.getElementById('osAdicionarReparo').addEventListener('click', () => {
            addRow('osReparosContainer', false);
            updateOSTotal();
        });

        // Remove Product/Reparo Row with Animation
        document.addEventListener('click', e => {
            if (e.target.classList.contains('btn-excluir-produto')) {
                const row = e.target.closest('.product-row');
                row.classList.add('deleting');
                setTimeout(() => {
                    row.remove();
                    if (row.closest('#vendaProdutosContainer')) {
                        updateVendaTotal();
                    } else {
                        updateOSTotal();
                    }
                }, 300);
            }
        });

        // Observation Checkboxes
        function setupObservationCheckboxes(prefix) {
            const lacrado = document.getElementById(`${prefix}Lacrado`);
            const semiNovo = document.getElementById(`${prefix}SemiNovo`);
            const textarea = document.getElementById(`${prefix}Observacoes`);

            lacrado.addEventListener('change', () => {
                if (lacrado.checked) {
                    textarea.value = 'Produto Lacrado.\nIMEI: ';
                    semiNovo.checked = false;
                } else if (!semiNovo.checked) {
                    textarea.value = '';
                }
            });

            semiNovo.addEventListener('change', () => {
                if (semiNovo.checked) {
                    textarea.value = 'Produto Semi-Novo.\nIMEI:\nBateria:\nTodos os testes foram devidamente realizados.';
                    lacrado.checked = false;
                } else if (!lacrado.checked) {
                    textarea.value = '';
                }
            });
        }

        setupObservationCheckboxes('venda');

        // Show Success Toast
        function showSuccessToast() {
            const toastEl = document.getElementById('successToast');
            const toast = new bootstrap.Toast(toastEl);
            toast.show();
        }

        // PDF Generation
        function generatePDF(type) {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            const prefix = type.toLowerCase();
            const isOS = type === 'OS';
            const form = document.getElementById(`${prefix}Form`);

            // Collect Form Data
            const nome = document.getElementById(`${prefix}Nome`).value;
            const cpf = document.getElementById(`${prefix}Cpf`).value;
            const celular = document.getElementById(`${prefix}Celular`).value;
            const email = document.getElementById(`${prefix}Email`).value;
            const cep = document.getElementById(`${prefix}Cep`).value;
            const endereco = document.getElementById(`${prefix}Endereco`).value;
            const numero = document.getElementById(`${prefix}Numero`).value;
            const bairro = document.getElementById(`${prefix}Bairro`).value;
            const cidade = document.getElementById(`${prefix}Cidade`).value;
            const estado = document.getElementById(`${prefix}Estado`).value;
            const formaPagamento = document.getElementById(`${prefix}FormaPagamento`).value;
            const valorPago = IMask.createPipe(currencyMask)(document.getElementById(`${prefix}ValorPago`).value).replace('R$ ', '');
            const observacoes = document.getElementById(`${prefix}Observacoes`).value;
            const orcamento = isOS ? IMask.createPipe(currencyMask)(document.getElementById(`${prefix}Orcamento`).value).replace('R$ ', '') : '';

            // Collect Products/Reparos
            const container = document.getElementById(`${prefix}ProdutosContainer`) || document.getElementById(`${prefix}ReparosContainer`);
            const items = [];
            let total = 0;
            container.querySelectorAll('.product-row').forEach(row => {
                if (isOS) {
                    const modelo = row.querySelector('input[name="modelo[]"]').value;
                    const reparos = Array.from(row.querySelectorAll('input[name="reparos[]"]:checked')).map(input => input.value);
                    const valorInput = row.querySelector('input[name="valor[]"]');
                    const valor = parseFloat(IMask.createPipe(currencyMask)(valorInput.value).replace('R$ ', '').replace('.', '').replace(',', '.')) || 0;
                    items.push({ modelo, reparos, valor });
                    total += valor;
                } else {
                    const produto = row.querySelector('input[name="produto[]"]').value;
                    const quantidade = parseInt(row.querySelector('input[name="quantidade[]"]').value) || 0;
                    const valorInput = row.querySelector('input[name="valor[]"]');
                    const valor = parseFloat(IMask.createPipe(currencyMask)(valorInput.value).replace('R$ ', '').replace('.', '').replace(',', '.')) || 0;
                    total += quantidade * valor;
                    items.push({ produto, quantidade, valor });
                }
            });

            // PDF Layout
            // Add Logo
            try {
                doc.addImage('./logo.png', 'PNG', 10, 10, 30, 30); // Logo at (10, 10), 40x40 mm
            } catch (e) {
                console.warn('Logo not found or failed to load:', e);
            }

            // Header Text (shifted right)
            doc.setFontSize(12);
            doc.text('GS Store - Vendas e Manutenção de Aparelhos', 50, 14);
            doc.setFontSize(10);
            doc.text('Rua Isaac Francisco Pimenta 23 B', 50, 20);
            doc.text('Whatsapp: (11) 99666-8683 | Email: contato@gsstore.com', 50, 26);
            doc.setFontSize(14);
            doc.text(type === 'Venda' ? 'Venda' : 'Reparo / Assistência', 50, 36);

            // Client Data
            doc.setFontSize(12);
            doc.text('DADOS DO CLIENTE', 10, 46);
            doc.setFontSize(10);
            doc.text(`Nome: ${nome}`, 10, 52);
            doc.text(`CPF: ${cpf}`, 80, 52);
            doc.text(`Celular: ${celular}`, 140, 52);
            doc.text(`Email: ${email}`, 10, 58);
            doc.text(`Endereço: ${endereco}, ${numero}`, 10, 64);
            doc.text(`Bairro: ${bairro}`, 10, 70);
            doc.text(`Cidade: ${cidade} - ${estado}`, 80, 70);
            doc.text(`CEP: ${cep}`, 140, 70);

            // Products/Reparos
            doc.setFontSize(12);
            doc.text(isOS ? 'REPARO' : 'PRODUTO', 10, 80);
            doc.setFontSize(10);
            let y = 86;
            if (isOS) {
                doc.line(10, y, 200, y);
                y += 4;
                doc.text('Modelo', 10, y);
                doc.text('Reparos', 70, y);
                doc.text('Valor', 170, y);
                y += 4;
                doc.line(10, y, 200, y);
                y += 4;
                items.forEach(item => {
                    doc.text(item.modelo, 10, y);
                    doc.text(`R$${item.valor.toFixed(2)}`, 170, y);
                    y += 6;
                    item.reparos.forEach(reparo => {
                        doc.text(`- ${reparo}`, 20, y);
                        y += 6;
                    });
                    y += 2;
                });
                doc.line(10, y, 200, y);
                y += 4;
                doc.text(`Valor do Orçamento: R$${total.toFixed(2)}`, 170, y);
                y += 6;
            } else {
                doc.line(10, y, 200, y);
                y += 4;
                doc.text('Item', 10, y);
                doc.text('Qtde', 100, y);
                doc.text('Preço Unitário', 130, y);
                doc.text('Total', 170, y);
                y += 4;
                doc.line(10, y, 200, y);
                y += 4;
                items.forEach(item => {
                    doc.text(item.produto, 10, y);
                    doc.text(item.quantidade.toString(), 100, y);
                    doc.text(`R$${item.valor.toFixed(2)}`, 130, y);
                    doc.text(`R$${(item.quantidade * item.valor).toFixed(2)}`, 170, y);
                    y += 6;
                });
                doc.line(10, y, 200, y);
                y += 4;
                doc.text(`Valor Total: R$${total.toFixed(2)}`, 170, y);
                y += 6;
            }

            // Payment Data
            doc.setFontSize(12);
            doc.text('DADOS DE PAGAMENTO', 10, y);
            doc.setFontSize(10);
            y += 6;
            doc.text(`Data: ${new Date().toLocaleDateString('pt-BR')}`, 10, y);
            doc.text(`Forma de Pagamento: ${formaPagamento}`, 80, y);
            doc.text(`Valor Pago: R$${valorPago}`, 140, y);

            // Observations
            y += 10;
            doc.setFontSize(12);
            doc.text('OBSERVAÇÕES', 10, y);
            doc.setFontSize(10);
            y += 6;
            doc.text(observacoes, 10, y);

            // Warranty
            y += 20;
            doc.setFontSize(12);
            doc.text('GARANTIA', 10, y);
            doc.setFontSize(8);
            y += 6;
            doc.text('*NÃO COBRIMOS NA GARANTIA DANOS EXTERNOS COMO: QUEDA, BOTÃO DE VOLUME, TRINCOS NA TELA OU CARCAÇA.*', 10, y);
            y += 6;
            doc.text('*NÃO COBRIMOS APARELHO COM MARCAS DE ÁGUA OU EXPOSTOS A VAPOR.*', 10, y);
            y += 6;
            doc.text('*NÃO TIRAR O SELO COLADO ABAIXO NO APARELHO, APARELHOS SEM SELO PERDEM A GARANTIA*', 10, y);

            // Signatures
            y += 20;
            doc.line(10, y, 60, y);
            doc.text('Assinatura Loja', 20, y + 5);
            doc.line(140, y, 190, y);
            doc.text('Assinatura Cliente', 150, y + 5);

            // Save PDF and Show Toast
            doc.save(`${type}_${new Date().toISOString().slice(0,10)}.pdf`);
            showSuccessToast();
        }

        document.getElementById('vendaGerarPdf').addEventListener('click', () => {
            if (document.getElementById('vendaForm').checkValidity()) {
                generatePDF('Venda');
            } else {
                document.getElementById('vendaForm').reportValidity();
            }
        });

        document.getElementById('osGerarPdf').addEventListener('click', () => {
            if (document.getElementById('osForm').checkValidity()) {
                generatePDF('OS');
            } else {
                document.getElementById('osForm').reportValidity();
            }
        });

        // Daily Motivational Quote
        const quotes = [
            "Comece onde você está, use o que você tem, faça o que você pode.",
            "O sucesso é a soma de pequenos esforços repetidos dia após dia.",
            "Acredite em você mesmo e todo o resto se encaixa.",
            "Cada novo dia é uma nova chance para mudar sua vida.",
            "Sonhe grande, trabalhe duro, permaneça focado.",
            "Você é mais forte do que imagina, nunca desista.",
            "A jornada de mil milhas começa com um único passo.",
            "O fracasso é apenas uma oportunidade para começar de novo, de forma mais inteligente.",
            "Faça hoje o que outros não fazem para ter amanhã o que outros não têm.",
            "Mantenha o foco nos seus objetivos, o resto é distração.",
            "Você não precisa ser perfeito para começar, mas precisa começar para ser perfeito.",
            "A persistência transforma sonhos em conquistas.",
            "O único limite é aquele que você impõe a si mesmo.",
            "Seja a mudança que você deseja ver no mundo.",
            "A coragem é o primeiro passo para o sucesso.",
            "Todo grande feito começa com uma pequena ação.",
            "A disciplina é a ponte entre seus sonhos e suas conquistas.",
            "O tempo é agora, faça acontecer!",
            "Você é capaz de muito mais do que imagina.",
            "O sucesso não é o destino, é a jornada.",
            "Acredite, persista, conquiste!",
            "Transforme obstáculos em oportunidades.",
            "Seu futuro é criado pelo que você faz hoje.",
            "O trabalho duro supera o talento quando o talento não trabalha duro.",
            "Cada dia é uma nova oportunidade para crescer.",
            "Não espere o momento perfeito, crie-o.",
            "A consistência é a chave para o progresso.",
            "Você é o autor da sua própria história.",
            "Grandes coisas vêm de pequenos começos.",
            "A determinação hoje leva ao sucesso amanhã."
        ];

        function displayDailyQuote() {
            const today = new Date().getDate();
            const quoteIndex = (today - 1) % quotes.length; // Cycle through quotes
            document.getElementById('dailyQuote').textContent = quotes[quoteIndex];
        }

        displayDailyQuote();
    </script>
</body>
</html>